'use server'
import Constants from "utils/Constants"

export async function getPaymentControl(orderNumber: string) {
    try {
        const response = await fetch(`${Constants.URL()}/auth/payment-control/${orderNumber}`, {
            method: "POST"
        });
        const data = await response.json();

        console.log("actions token", data);

        if (response.status == 200) {
            const paymentStep2Response = await fetch(`${Constants.URL()}/api/payment-step2`, {
                method: "POST",
                body: JSON.stringify({
                    token: data.token,
                    conversationId: data.conversationId,
                })
            })
            if (paymentStep2Response.status == 200) {
                const result = await paymentStep2Response.json();
                return { status: response.status == 200 ? "success" : "failure", data: result };
            }
            return { status: "failure", data: null }
        }

        return { status: "failure", data: null }
    } catch (error) {
        console.log(error);
        return { status: "failure", data: null }
    }
}
